@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@model PredelNews.Core.ViewModels.ArticleDetailViewModel

<!-- Ad: Header Leaderboard -->
<div class="container my-3">
  <div class="pn-ad-slot pn-ad-leaderboard"><span>728 &times; 90</span></div>
</div>

<div class="container py-4">
  <div class="row g-4">
    <div class="col-lg-8">
      <article>
        @await Html.PartialAsync("_Breadcrumb", Model.Breadcrumbs)

        @if (Model.IsSponsored)
        {
          <div class="mb-3">
            @await Html.PartialAsync("_SponsoredBanner")
          </div>
        }

        <header class="mb-4">
          <div class="d-flex flex-wrap gap-2 mb-3">
            @if (Model.IsSponsored)
            {
              <span class="badge pn-badge-sponsored">Платена публикация</span>
            }
            @if (!string.IsNullOrEmpty(Model.CategoryName))
            {
              <a href="@Model.CategoryUrl" class="badge pn-badge-category text-decoration-none">@Model.CategoryName</a>
            }
            @if (!string.IsNullOrEmpty(Model.RegionName))
            {
              <a href="@Model.RegionUrl" class="badge pn-badge-region text-decoration-none">@Model.RegionName</a>
            }
          </div>
          <h1 class="display-6 fw-bold mb-3" style="line-height:1.2">@Model.Headline</h1>
          @if (!string.IsNullOrEmpty(Model.Subtitle))
          {
            <p class="lead text-meta">@Model.Subtitle</p>
          }
          <div class="d-flex flex-wrap align-items-center gap-3 py-3 border-top border-bottom small text-meta">
            @if (!Model.IsSponsored && !string.IsNullOrEmpty(Model.AuthorName))
            {
              <a href="@Model.AuthorUrl" class="fw-semibold text-decoration-none" style="color:var(--pn-primary)">
                <i class="bi bi-person-circle me-1"></i>@Model.AuthorName
              </a>
            }
            <span><i class="bi bi-calendar3 me-1"></i><time datetime="@Model.PublishDate.ToString("yyyy-MM-dd")">@Model.PublishDate.ToString("dd MMMM yyyy, HH:mm")</time></span>
            @if (Model.CommentCount > 0)
            {
              <span><i class="bi bi-chat-dots me-1"></i>@Model.CommentCount коментара</span>
            }
          </div>
        </header>

        @if (!string.IsNullOrEmpty(Model.CoverImageUrl))
        {
          <figure class="mb-4">
            <img src="@Model.CoverImageUrl"
                 @if (!string.IsNullOrEmpty(Model.CoverImageSrcSet)) { <text>srcset="@Model.CoverImageSrcSet" sizes="(max-width: 768px) 100vw, 780px"</text> }
                 class="img-fluid rounded"
                 alt="@(Model.CoverImageAlt ?? Model.Headline)">
            @if (!string.IsNullOrEmpty(Model.CoverImageAlt))
            {
              <figcaption class="small text-meta fst-italic mt-2">@Model.CoverImageAlt</figcaption>
            }
          </figure>
        }

        @await Html.PartialAsync("_ShareButtons", null, new ViewDataDictionary(ViewData) { { "ShareUrl", Model.ShareUrl } })

        <div class="pn-article-body mt-4">
          @Html.Raw(Model.Body)
        </div>

        @if (Model.Tags.Count > 0)
        {
          <div class="d-flex flex-wrap gap-2 py-4 border-top mt-4">
            @foreach (var tag in Model.Tags)
            {
              <a href="@tag.Url" class="pn-tag">#@tag.Name</a>
            }
          </div>
        }

        @await Html.PartialAsync("_ShareButtons", null, new ViewDataDictionary(ViewData) { { "ShareUrl", Model.ShareUrl } })

        @if (Model.IsSponsored)
        {
          <div class="mt-3">
            @await Html.PartialAsync("_SponsoredBanner")
          </div>
        }

        <div class="pn-ad-slot pn-ad-article-bottom my-4"><span>728 &times; 90</span></div>

        <!-- Related -->
        @if (Model.RelatedArticles.Count > 0)
        {
          <section class="my-5">
            <div class="pn-section-header d-flex justify-content-between align-items-center">
              <h2 class="pn-section-title">Свързани новини</h2>
            </div>
            <div class="row g-3">
              @foreach (var related in Model.RelatedArticles.Take(3))
              {
                <div class="col-md-4">
                  @await Html.PartialAsync("_ArticleCard", related)
                </div>
              }
            </div>
          </section>
        }

        <!-- Comments placeholder (EPIC-05) -->
        <section class="mt-5" aria-label="Коментари">
          <div class="pn-section-header d-flex justify-content-between align-items-center">
            <h2 class="pn-section-title">Коментари</h2>
          </div>
          <p class="small text-meta">Коментарите ще бъдат активирани скоро.</p>
        </section>
      </article>
    </div>

    <!-- Sidebar -->
    <aside class="col-lg-4">
      <div class="pn-ad-slot pn-ad-sidebar mb-4"><span>300 &times; 250</span></div>
      <div class="pn-widget p-3 mb-4">
        <h3 class="pn-widget-title mb-3">Най-четено</h3>
        <ol class="pn-most-read">
          <li><a href="#">Очаквайте скоро</a></li>
        </ol>
      </div>
    </aside>
  </div>
</div>

@await Html.PartialAsync("_JsonLd", Model)
