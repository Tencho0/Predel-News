@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@model PredelNews.Core.ViewModels.HomePageViewModel

<!-- Ad: Header Leaderboard -->
<div class="container my-3">
  <div class="pn-ad-slot pn-ad-leaderboard"><span>728 &times; 90</span></div>
</div>

<!-- BREAKING NEWS -->
<section class="py-4" aria-label="Последни новини">
  <div class="container">
    <div class="pn-section-header d-flex justify-content-between align-items-center">
      <h2 class="pn-section-title">Последни новини</h2>
      <a href="/vsichki-novini" class="pn-section-link">Всички <i class="bi bi-arrow-right"></i></a>
    </div>

    <div class="row g-4">
      <!-- Featured -->
      @if (Model.FeaturedArticle != null)
      {
        <div class="col-lg-8">
          @await Html.PartialAsync("_ArticleCard", Model.FeaturedArticle, new ViewDataDictionary(ViewData) { { "Featured", true } })
        </div>
      }

      <!-- Headlines -->
      @if (Model.HeadlineLinks.Count > 0)
      {
        <div class="col-lg-4">
          <div class="list-group list-group-flush h-100">
            @foreach (var item in Model.HeadlineLinks)
            {
              <a href="@item.ArticleUrl" class="list-group-item list-group-item-action px-0 py-3">
                @if (!string.IsNullOrEmpty(item.CategoryName))
                {
                  <span class="badge pn-badge-category mb-1">@item.CategoryName</span>
                }
                <h6 class="mb-1 fw-semibold">@item.Headline</h6>
                <small class="text-meta">@item.PublishDate.ToString("dd MMM yyyy")</small>
              </a>
            }
          </div>
        </div>
      }
    </div>
  </div>
</section>

<!-- NATIONAL / WORLD STRIP -->
@if (Model.NationalHeadlines.Count > 0)
{
  <section class="pn-national-strip py-4" aria-label="България и свят">
    <div class="container">
      <div class="pn-section-header d-flex justify-content-between align-items-center" style="border-bottom-color:var(--pn-accent)">
        <h2 class="pn-section-title" style="font-size:1.25rem"><i class="bi bi-globe-europe-africa me-2"></i>България &amp; Свят</h2>
      </div>
      <div class="row g-3">
        @foreach (var article in Model.NationalHeadlines)
        {
          <div class="col-md-4">
            @await Html.PartialAsync("_ArticleCard", article)
          </div>
        }
      </div>
    </div>
  </section>
}

<!-- CATEGORY SECTIONS -->
@{ var sectionIndex = 0; }
@foreach (var block in Model.CategoryBlocks)
{
  <section class="py-5 @(sectionIndex % 2 == 1 ? "bg-surface" : "")" aria-label="@block.CategoryName">
    <div class="container">
      <div class="pn-section-header d-flex justify-content-between align-items-center">
        <h2 class="pn-section-title">@block.CategoryName</h2>
        <a href="@block.CategoryUrl" class="pn-section-link">Всички <i class="bi bi-arrow-right"></i></a>
      </div>
      <div class="row g-4">
        @foreach (var article in block.Articles.Take(3))
        {
          <div class="col-md-6 col-lg-4">
            @await Html.PartialAsync("_ArticleCard", article)
          </div>
        }
      </div>
    </div>
  </section>
  sectionIndex++;
}

<!-- LATEST NEWS + SIDEBAR -->
<section class="py-5 bg-surface" aria-label="Най-новото">
  <div class="container">
    <div class="row g-4">
      <!-- Feed -->
      <div class="col-lg-8">
        <div class="pn-section-header d-flex justify-content-between align-items-center">
          <h2 class="pn-section-title">Най-новото</h2>
        </div>

        <div class="d-flex flex-column gap-3">
          @foreach (var article in Model.LatestArticles)
          {
            @await Html.PartialAsync("_ArticleCard", article, new ViewDataDictionary(ViewData) { { "Variant", "horizontal" } })
          }
        </div>

        @{
          var totalLatestPages = (int)Math.Ceiling(Model.LatestArticlesTotalCount / 20.0);
        }
        @await Html.PartialAsync("_Pagination", new PredelNews.Core.ViewModels.PaginationViewModel
        {
          CurrentPage = Model.CurrentPage,
          TotalPages = totalLatestPages,
          TotalItems = Model.LatestArticlesTotalCount,
          PageSize = 20,
          BaseUrl = "/",
        })
      </div>

      <!-- Sidebar -->
      <aside class="col-lg-4">
        <div class="pn-ad-slot pn-ad-sidebar mb-4"><span>300 &times; 250</span></div>

        <!-- Most Read placeholder -->
        <div class="pn-widget p-3 mb-4">
          <h3 class="pn-widget-title mb-3">Най-четено</h3>
          <ol class="pn-most-read">
            <li><a href="#">Очаквайте скоро</a></li>
          </ol>
        </div>
      </aside>
    </div>
  </div>
</section>
